<!doctype html>
<meta charset="UTF-8">

<h1>Web Cryptography API - RSA OAEP encrypt/decrypt</h1>
<p>
Successful tested with
<ul>
	<li>Chrome 37</li>
	<li>Firefox 35.0a1 (2014-09-28) Nightly</li>
</ul>
See debug console.
</p>

<script src="js/commons.js"></script>
<script>

	var algorithmName = "RSA-OAEP";
	var modLength = 2048;
	var exponent = new Uint8Array([1, 0, 1]); // 24 bit representation of 65537
	var hashAlgo = "SHA-256";
	var extractable = true; // can extract it later if we want
	var keyUsages = ["encrypt", "decrypt"];
	var buf = new Uint8Array([1,2,3]);

	var rsaOaepParams =  {
		name: algorithmName,
		modulusLength: modLength,
		publicExponent: exponent,
		hash: {
			name: hashAlgo
		}
	};

    var rsaHashedImportParams = {
      	hash: {
			name: hashAlgo
		}  
    }

	console.log("Raw data: ", buf);

	crypto.subtle.generateKey(rsaOaepParams, extractable, keyUsages).then(function(keys) {
		console.log("Keys:", keys);

		crypto.subtle.exportKey('spki', keys.publicKey).then(function(key_ab) {
			console.log("Exported key", new Uint8Array(key_ab));

		    crypto.subtle.importKey("spki", key_ab, { name: algorithmName, hash: { name: hashAlgo } }, true, ["encrypt"]).then(function(key_imp) {
			    console.log("Imported key", key_imp);

		        crypto.subtle.encrypt(rsaOaepParams, key_imp, buf).then(function(encryptedData) {
			        console.log("encrypted data: ", new Uint8Array(encryptedData));

			        crypto.subtle.decrypt(rsaOaepParams, keys.privateKey, encryptedData).then(function(decryptedData) {
				        var dec_data = new Uint8Array(decryptedData);
				        console.log("decrypted data: ", dec_data);
			        });
		        });
            });
        });

/*		



*/

	});

</script>

